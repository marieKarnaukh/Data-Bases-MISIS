# Data-Bases-MISIS

# 1. Постановка задачи
Предметная область: Кафедра ВУЗа. 
Необходимо разработать БД, которая должна обеспечивать информационную поддержку 
учебного процесса и организационной деятельности на кафедре ВУЗа. БД должна содержать 
учебный план, расписание занятий, списки групп, выпускаемых кафедрой, и списки 
аспирантов (с руководителями и темами исследований). 
БД должна обеспечивать составление: 
- расписания занятий на семестр (по группам); 
- учебного плана (по семестрам) для каждого курса; 
- расписания занятий для преподавателей; 
- списка телефонов сотрудников; 
- нагрузки по часам для преподавателей; 
- списка научных кадров по научным направлениям; 
- списков студентов-дипломников (по группам и по преподавателям).
# 2. Описание структуры БД
## Реляционная модель
### Таблица "Должность":
- Атрибуты: ID_должности (PK), Оклад, Ставка, Название_должности.
### Таблица "Сотрудник":
- Атрибуты: ID_сотрудника (PK), ID_должности (FK), Электронная_почта, 
Номер_телефона, Имя, Фамилия, Отчество.
- Внешний ключ: ID_должности (ссылается на ID_должности в таблице "Должность").
### Таблица "Преподаватель":
- Атрибуты: ID_преподавателя (PK), ID_сотрудника (FK), Стаж, Научная_степень.
- Внешний ключ: ID_сотрудника (ссылается на ID_сотрудника в таблице "Сотрудник").
### Таблица "Пара":
- Атрибуты: ID_пары (PK), День_недели, Время_окончания, Время_начала, 
Верхняя_нижняя_неделя.
### Таблица "Уровень_подготовки":
- Атрибуты: ID_уровня_подготовки (PK), Название_уровня_подготовки, 
Форма_обучения.
### Таблица "Направление_подготовки":
- Атрибуты: ID_направления_подготовки (PK), ID_уровня_подготовки (FK), 
Название_направления_подготовки, Область_образования.
- Внешний ключ: ID_уровня_подготовки (ссылается на ID_уровня_подготовки в 
таблице "Уровень_подготовки").
### Таблица "Дисциплина":
- Атрибуты: ID_дисциплины (PK), ID_направления_подготовки (FK), Номер_семестра, 
Название_дисциплины, Часы_практики, Часы_лабораторных, Часы_лекций, 
Количество_зачётных_единиц.
- Внешний ключ: ID_направления_подготовки (ссылается на 
ID_направления_подготовки в таблице "Направление_подготовки").
### Таблица "Группа":
- Атрибуты: ID_группы (PK), ID_куратора (FK), Номер_курса, Название_группы, 
Количество_студентов, ID_направления_подготовки.
- Внешний ключ: ID_куратора (ссылается на ID_преподавателя в таблице 
"Преподаватель").
- Внешний ключ: ID_направления_подготовки (ссылается на 
ID_направления_подготовки в таблице "Направление_подготовки").
### Таблица "Расписание_занятий":
- Атрибуты: ( ID_преподавателя (FK), ID_пары (FK) )(PK), ID_дисциплины (FK), 
ID_группы (FK), Номер_аудитории.
- Внешние ключи: ID_преподавателя (ссылается на ID_преподавателя в таблице 
"Преподаватель"), ID_пары (ссылается на ID_пары в таблице "Пара"), ID_дисциплины 
(ссылается на ID_дисциплины в таблице "Дисциплина"), ID_группы (ссылается на 
ID_группы в таблице "Группа").
### Таблица "Студент":
- Атрибуты: ID_студента (PK), ID_научного_руководителя (FK), ID_группы (FK), 
Дата_рождения, Электронная_почта, Имя, Фамилия, Отчество.
- Внешние ключи: ID_научного_руководителя (ссылается на ID_преподавателя в 
таблице "Преподаватель"), ID_группы (ссылается на ID_группы в таблице "Группа").
![изображение](https://github.com/user-attachments/assets/f0e272ab-b92d-4035-adcc-3624d6dbee5d)
## Анализ функциональных зависимостей
- Все отношения находятся в 1НФ, так как все их атрибуты являются простыми, все 
используемые домены содержат только скалярные значения.
- Все отношения находятся в 2НФ, так как находятся в 1НФ и все неключевые атрибуты 
функционально зависят от полного первичного ключа.
- Все отношения находятся в 3НФ, так как находятся во 2НФ и не имеют транзитивных 
зависимостей неключевых атрибутов от первичного ключа.
# 3. Заполнение БД информацией
Данные для заполнения таблиц генерируются с помощью ChatGPT и заполняются в 
ручном режиме.
# 4. Описание представлений
- v_DiplomaStudents – список студентов-дипломников с научными руководителями
- v_GroupCurator - информация о группах и их кураторах
- v_GetSalary – информация о зарплаты сотрудников (рассчитывается исходя из оклада и 
ставки)
- v_TeachersList - список всех преподавателей с их должностями
# 5. Описание функций
- fn_CreateScheduleForGroup (@GroupName) - формирует расписание для конкретной 
группы
- fn_CreateScheduleForTeacher (@Name, @SecondName, @Surname) - формирует 
расписание для преподавателя
- fn_GetStudentsByGroup (@GroupName) - получение списка студентов по номеру группы
- fn_GetEmployeePhoneList (
 @FirstName = NULL,
 @LastName = NULL,
 @MiddleName = NULL) - возвращает контактную информацию сотрудника, если он 
указан, в противном случае – возвращается список контактной информации всех 
сотрудников
- fn_GetListOfDisciplines(@DirectionName) – формирует список дисциплин для 
определенного направления
- fn_CalculateWorkloadForTeacher(@TeacherID) – рассчитывает нагрузку по часам для 
преподавателя
# 6. Описание хранимых процедур
- pr_AddNewStudent (
 @Дата_рождения,
 @Имя,
 @Фамилия,
 @Отчество = NULL,
 @ID_группы = NULL,
 @ID_научного_руководителя = NULL) - добавление нового студента. Если 
группа не указана, то студент добавляется в группу с наименьшим количеством человек. 
Также для нового студента автоматически формируется электронная почта.
- pr_AddNewEmployee (
 @ID_должности,
 @Имя,
 @Фамилия,
 @Отчество = NULL,
 @Электронная_почта = NULL,
 @Номер_телефона = NULL,
 @Стаж = NULL,
 @Научная_степень = NULL) - добавление нового сотрудника с проверкой, что его 
должность соответствует должностям, которое есть на кафедре. Если сотрудник является 
преподавателем, то информация об этом сотруднике добавляется в таблицу "Преподаватель".
- pr_RemoveStudent(@StudentID) – удаление(отчисление) студента 
- pr_RemoveEmployee(@ID_сотрудника) - удаление сотрудника. Если сотрудник 
является преподавателем, то сначала удаляется запись о нём как о преподавателе, а затем –
как о сотруднике.
- pr_TransferStudentToAnotherGroup (
 @ID_студента,
 @ID_группы_новой) - перевод студента в другую группу с проверкой, что студент с 
заданным ID и группа существуют.
# 7. Описание триггеров
- tr_ReplaceTeacherInSchedule – триггер, срабатывающий вместо удаления
преподавателя. Перед его удалением триггер сначала заменяет ID_преподавателя, которого 
удаляем, в расписании на ID другого преподавателя. Также, если преподавателя является 
научным руководителем студента, то ID_научного_руководителя для студента становится 
NULL.
- tr_UpdateStudentCount – триггер, срабатывающий после любых изменений в таблице 
"Студент". Триггер обновляет количество студентов в группах, в которые были 
добавлены/из которых были удалены студенты.
- tr_UpdateTeacherSalary – триггер, который увеличивает оклад преподавателя на 5% 
за каждый год стажа. Срабатывает после вставки или обновления записи в таблице 
"Преподаватель".
# 8. Пример работы с БД с использованием созданных объектов
- Пусть куратор группы БПМ-22-1 перед началом семестра хочет получить расписание 
группы и список всех студентов этой группы.
Тогда куратор может воспользоваться функциями fn_CreateScheduleForGroup и 
fn_GetStudentsByGroup
![изображение](https://github.com/user-attachments/assets/c9a5e22f-0988-4b2c-8aff-81ab0c28788b)
![изображение](https://github.com/user-attachments/assets/932c2663-b514-4031-802d-9f00fdf5b6aa)

- Пусть в начале семестра нужно зачислить нового студента из другого вуза. Также другой 
студент написал заявление о переводе в другую группу. Для добавления нового студента и 
перевода другого можно воспользоваться функциями pr_AddNewStudent и 
pr_TransferStudentToAnotherGroup.
При добавлении нового студента можно не указывать ID группы, процедура добавит студента 
в группу с наименьшим числом студентов. Это нужно для того, чтобы группы заполнялись 
равномерно.
![изображение](https://github.com/user-attachments/assets/e1351b63-b8c2-4297-86a1-4e8151c429ef)

Допустим, что мы допустили ошибку при попытке перевода студента в другую группу –
указали несуществующий ID студента. Тогда выведет сообщение о нашей ошибке.
![изображение](https://github.com/user-attachments/assets/15f75539-3968-40be-8c77-046ffd702705)

Далее, выполним запрос с корректным ID студента. Увидим сообщение об успешном 
выполнении перевода.
![изображение](https://github.com/user-attachments/assets/032db50f-8bcb-406e-86cd-1f3ac39562f0)
